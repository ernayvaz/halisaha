module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},98043,e=>{"use strict";e.s(["prisma",()=>r]);var t=e.i(29173);let r=global.__prisma__||new t.PrismaClient({log:["error","warn"],datasources:{db:{url:process.env.DATABASE_URL+"&connect_timeout=60&pool_timeout=60&socket_timeout=60"}}})},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},36822,e=>{"use strict";e.s(["GET",()=>s,"POST",()=>i]);var t=e.i(89171),r=e.i(98043),a=e.i(26355);function n(e){if(!e.date||!e.startTime)return null;let[t,r]=(e.startTime||"00:00").split(":").map(Number),a=new Date(e.date);a.setHours(t||0,r||0,0,0);let n=new Date(a.getTime()+(e.durationMinutes??60)*6e4);return{start:a,end:n}}async function i(){let e=new Date;await r.prisma.historySnapshot.deleteMany({where:{ttlAt:{lte:e}}});let a=await r.prisma.event.findMany({where:{status:"open"}}),i=0;for(let t of a){let a=n({date:t.date,startTime:t.startTime,durationMinutes:t.durationMinutes});if(!a)continue;let s=Math.ceil((a.start.getTime()-e.getTime())/36e5),l=3===s&&!t.preNotify3hSent,d=2===s&&!t.preNotify2hSent,p=1===s&&!t.preNotify1hSent;if(l||d||p){let e=`Match starts in ${s} hour${s>1?"s":""}`;await o("Match reminder",e),await r.prisma.event.update({where:{id:t.id},data:{preNotify3hSent:!!l||t.preNotify3hSent,preNotify2hSent:!!d||t.preNotify2hSent,preNotify1hSent:!!p||t.preNotify1hSent}}),i++}e>=a.end&&"open"===t.status&&await r.prisma.event.update({where:{id:t.id},data:{status:"finished"}});let u=new Date(a.end.getTime()+6e5);if(e>=u){let e=await r.prisma.mVPPoll.upsert({where:{eventId:t.id},update:{},create:{eventId:t.id,startsAt:u,endsAt:new Date(u.getTime()+18e5)}});!e.finalized&&!e.notifSent&&(await o("MVP voting started","Open the link to vote your MVP"),await r.prisma.mVPPoll.update({where:{id:e.id},data:{notifSent:!0}}),i++)}}let s=await r.prisma.event.findMany({where:{status:"finished"}}),l=0;for(let t of s){let a=n({date:t.date,startTime:t.startTime,durationMinutes:t.durationMinutes});if(a){let n=new Date(a.end.getTime()+6e5);if(e>=n){let e=await r.prisma.mVPPoll.upsert({where:{eventId:t.id},update:{},create:{eventId:t.id,startsAt:n,endsAt:new Date(n.getTime()+18e5)}});!e.finalized&&!e.notifSent&&(await o("MVP voting started","Open the link to vote your MVP"),await r.prisma.mVPPoll.update({where:{id:e.id},data:{notifSent:!0}}),i++)}}let s=await r.prisma.mVPPoll.findUnique({where:{eventId:t.id}});if(!s||!s.finalized||!s.endsAt||e<new Date(s.endsAt.getTime()+36e5))continue;let d=(await r.prisma.team.findMany({where:{eventId:t.id},select:{id:!0}})).map(e=>e.id);await r.prisma.$transaction([r.prisma.lineupPosition.deleteMany({where:{teamId:{in:d}}}),r.prisma.assignment.deleteMany({where:{teamId:{in:d}}}),r.prisma.team.deleteMany({where:{eventId:t.id}}),r.prisma.participant.deleteMany({where:{eventId:t.id}}),r.prisma.mVPPoll.deleteMany({where:{eventId:t.id}}),r.prisma.event.update({where:{id:t.id},data:{status:"open",rosterLocked:!1,lineupLocked:!1,preNotify1hSent:!1,preNotify2hSent:!1,preNotify3hSent:!1}})]),l++}return t.NextResponse.json({pushed:i,resets:l})}async function s(e){return i()}async function o(e,t){let n=await r.prisma.pushSubscription.findMany(),i=process.env.VAPID_PUBLIC_KEY,s=process.env.VAPID_PRIVATE_KEY,o=process.env.VAPID_EMAIL||"mailto:admin@example.com";if(!i||!s)return;a.default.setVapidDetails(o,i,s);let l=JSON.stringify({title:e,body:t});await Promise.all(n.map(async e=>{try{await a.default.sendNotification({endpoint:e.endpoint,keys:{p256dh:e.p256dh,auth:e.auth}},l)}catch{}}))}},91546,(e,t,r)=>{},57733,e=>{"use strict";e.s(["handler",()=>E,"patchFetch",()=>P,"routeModule",()=>v,"serverHooks",()=>g,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>R]);var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(69741),o=e.i(16795),l=e.i(87718),d=e.i(95169),p=e.i(47587),u=e.i(66012),c=e.i(70101),m=e.i(26937),h=e.i(10372),x=e.i(93695);e.i(52474);var f=e.i(220),w=e.i(36822);let v=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/cron/match-timers/route",pathname:"/api/cron/match-timers",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/cron/match-timers/route.ts",nextConfigOutput:"standalone",userland:w}),{workAsyncStorage:y,workUnitAsyncStorage:R,serverHooks:g}=v;function P(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:R})}async function E(e,t,a){var w;let y="/api/cron/match-timers/route";y=y.replace(/\/index$/,"")||"/";let R=await v.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:g,params:P,nextConfig:E,isDraftMode:A,prerenderManifest:T,routerServerContext:N,isOnDemandRevalidate:S,revalidateOnlyGenerated:C,resolvedPathname:M}=R,q=(0,s.normalizeAppPath)(y),b=!!(T.dynamicRoutes[q]||T.routes[M]);if(b&&!A){let e=!!T.routes[M],t=T.dynamicRoutes[q];if(t&&!1===t.fallback&&!e)throw new x.NoFallbackError}let _=null;!b||v.isDev||A||(_="/index"===(_=M)?"/":_);let I=!0===v.isDev||!b,k=b&&!I,D=e.method||"GET",O=(0,i.getTracer)(),j=O.getActiveScopeSpan(),U={params:P,prerenderManifest:T,renderOpts:{experimental:{cacheComponents:!!E.experimental.cacheComponents,authInterrupts:!!E.experimental.authInterrupts},supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(w=E.experimental)?void 0:w.cacheLife,isRevalidate:k,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>v.onRequestError(e,t,a,N)},sharedContext:{buildId:g}},H=new o.NodeNextRequest(e),V=new o.NodeNextResponse(t),$=l.NextRequestAdapter.fromNodeNextRequest(H,(0,l.signalFromNodeResponse)(t));try{let s=async r=>v.handle($,U).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=O.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${D} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${D} ${e.url}`)}),o=async i=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&S&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(i);e.fetchMetrics=U.renderOpts.fetchMetrics;let l=U.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=U.renderOpts.collectedTags;if(!b)return await (0,u.sendResponse)(H,V,o,U.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,c.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==U.renderOpts.collectedRevalidate&&!(U.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&U.renderOpts.collectedRevalidate,a=void 0===U.renderOpts.collectedExpire||U.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:U.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:k,isOnDemandRevalidate:S})},N),t}},x=await v.handleResponse({req:e,nextConfig:E,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:a.waitUntil});if(!b)return null;if((null==x||null==(o=x.value)?void 0:o.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==x||null==(l=x.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",S?"REVALIDATED":x.isMiss?"MISS":x.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let w=(0,c.fromNodeOutgoingHttpHeaders)(x.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&b||w.delete(h.NEXT_CACHE_TAGS_HEADER),!x.cacheControl||t.getHeader("Cache-Control")||w.get("Cache-Control")||w.set("Cache-Control",(0,m.getCacheControlHeader)(x.cacheControl)),await (0,u.sendResponse)(H,V,new Response(x.value.body,{headers:w,status:x.value.status||200})),null};j?await o(j):await O.withPropagatedContext(e.headers,()=>O.trace(d.BaseServerSpan.handleRequest,{spanName:`${D} ${e.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},o))}catch(t){if(j||t instanceof x.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:k,isOnDemandRevalidate:S})}),b)throw t;return await (0,u.sendResponse)(H,V,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fef65141._.js.map